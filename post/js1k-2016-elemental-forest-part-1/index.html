<!DOCTYPE html> <html class="overflow-x-hidden text-xs md:text-base no-js" lang="en"> <head> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-71788573-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-71788573-1'); </script> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <meta name="theme-color" content="#FFFFFF"> <meta name="description" content="The first part of my post-mortem blog post about my 2016 JS1k entry 'Elemental Forest'" /> <title> JS1k 2016: Elemental Forest &mdash; Part 1 &mdash; gamehelp16.github.io </title> <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png"> <link rel="manifest" href="/assets/images/favicon/site.webmanifest"> <link rel="stylesheet" href="https://rsms.me/inter/inter.css"> <link rel="stylesheet" href="/assets/css/style.css"> </head> <body class="relative text-lg antialiased leading-relaxed text-gray-900 dark:bg-background-dark dark:text-gray-100" data-barba="wrapper"> <script src="/assets/js/beforeContent.js"></script> <div data-barba="container"> <header class="container flex items-center justify-between py-10"> <h1 class="flex items-center md:text-xl enter-anim"> <a href="/" class="inline-block text-purple-800 whitespace-no-wrap dark:text-teal-300 hover:underline"> gamehelp16.github.io </a> <span class="hidden text-gray-600 md:inline-block dark:text-gray-400"><span class="mx-4">/</span>post</span> </h1> <div class="flex items-center flex-shrink-0 enter-anim no-js-hidden"> <div class="hidden mr-4 text-gray-700 dark:text-gray-500 xl:block">night mode</div> <button onclick="toggleDarkMode()" id="dark-mode-toggle" aria-label="turn night mode on/off"> <div></div> </button> </div> </header> <main> <header class="container mt-20"> <h1 class="text-5xl font-semibold leading-tight tracking-tight text-black lg:leading-tighter lg:text-7xl lg:tracking-80 dark:text-white enter-anim"> JS1k 2016: Elemental Forest — Part 1 </h1> <div class="mt-2 leading-relaxed text-gray-700 lg:mt-3 md:text-xl dark:text-gray-400 enter-anim"> <span class="mr-1">Published on <time datetime="2016-03-17T00:00:00+08:00">March 17, 2016</time></span> </div> </header> <article class="container mt-12 markdown post-content enter-anim"> <p>This year is my third year participating in <a href="http://js1k.com/" target="_blank" rel="noopener noreferrer">JS1k</a>, a contest about making something cool using Javascript in 1 kilobyte or less. After submitting two <a href="http://js1k.com/2014-dragons/demo/1649" target="_blank" rel="noopener noreferrer">text based</a> <a href="http://js1k.com/2015-hypetrain/demo/2118" target="_blank" rel="noopener noreferrer">demos</a> (those are two links, btw), this year I submitted a more pleasing to the eye demo and I called it “Elemental Forest”.</p> <div class="inner-container"> <blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">⚛ Elemental Forest is a <a href="https://twitter.com/hashtag/js1k?src=hash" target="_blank" rel="noopener noreferrer">#js1k</a> demo by Richard Sudaryono (<a href="https://twitter.com/gamehelp16" target="_blank" rel="noopener noreferrer">@gamehelp16</a>) <a href="https://t.co/lU2HABTCET" target="_blank" rel="noopener noreferrer">https://t.co/lU2HABTCET</a> <a href="https://t.co/6FtaPd5LQg" target="_blank" rel="noopener noreferrer">pic.twitter.com/6FtaPd5LQg</a></p>— JS1K (@js1k) <a href="https://twitter.com/js1k/status/700049453919637504" target="_blank" rel="noopener noreferrer">February 17, 2016</a>
</blockquote> </div> <p>This demo was inspired by <a href="https://www.androidexperiments.com/experiment/grove" target="_blank" rel="noopener noreferrer">Grove</a>, an Android Experiment by Simon Geilfus. Also, I would like to thank <a href="https://www.youtube.com/user/codingmath" target="_blank" rel="noopener noreferrer">Coding Math</a> YouTube channel for the awesome tutorials. Without it my submission this year probably would just be another text based one.</p>
<hr> <p>In this and the next post I will explain the code that works behind the demo, but before that let’s take a look at the ‘original’ source of the demo (you will know why the word ‘original’ is quoted). You can also view the source code on <a href="https://gist.github.com/gamehelp16/d4f7260c31d98261ccbb" target="_blank" rel="noopener noreferrer">GitHub Gist</a>.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/*

  Story time, after submitting an update to the demo I planned to make another
  update for the demo (which I didn't submit in the end) so I edited the code
  to do some edits etc etc. And maybe you've guessed it, stupid me didn't make
  a copy of the original source of the demo and just modified the code straight
  away. Therefore, I have to reverse the changes in the code but I can't seem to
  restore the changes completely. So, here's the almost original source of the
  demo. It's not exactly the same as the one submitted, but it's almost the same
  and the differences between this and the original code should be just very
  minor things.

  TL;DR this is not exactly the original source of the demo I submitted.

*/</span>

<span class="cm">/*

  a, b, c = shim
  e = theme color h
  f = frame number
  g = theme color l
  h = canvas height
  i, k, K = looping variable
  r() = generate seeded random number
  R() = render
  s = random number seed
  S = random number
  t[] = road data
  T() = draw tree
  w = canvas width
  x, y, z = function variable
  X, Y, Z = placeholder variable

*/</span>

<span class="nx">S</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
<span class="nx">s</span> <span class="o">=</span> <span class="nx">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="nx">t</span> <span class="o">=</span> <span class="p">[],</span>
<span class="nx">e</span> <span class="o">=</span> <span class="nx">S</span> <span class="o">*</span> <span class="mi">360</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="nx">k</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span><span class="nx">k</span><span class="o">--</span><span class="p">;)</span><span class="nx">t</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">k</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span><span class="o">*</span><span class="mi">500</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span><span class="mi">150</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">k</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span><span class="mi">180</span><span class="o">-</span><span class="nx">k</span><span class="p">,</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span><span class="nx">k</span><span class="p">]);</span> <span class="c1">//[x,y,z,seed,tree type]</span>
<span class="nx">R</span><span class="p">()</span>

<span class="kd">function</span> <span class="nx">r</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span> <span class="mi">9301</span> <span class="o">+</span> <span class="mi">49297</span><span class="p">)</span> <span class="o">%</span> <span class="mi">233280</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">s</span> <span class="o">/</span> <span class="mi">233280</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">R</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">=</span> <span class="nx">S</span><span class="p">;</span>
  <span class="nx">c</span><span class="p">.</span><span class="nx">fillStyle</span><span class="o">=</span><span class="dl">"</span><span class="s2">hsl(</span><span class="dl">"</span><span class="o">+</span><span class="p">[</span><span class="nx">e</span><span class="o">+=</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">90%</span><span class="dl">"</span><span class="p">,</span><span class="nx">g</span><span class="o">=</span><span class="nx">s</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="mi">50</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">%)</span><span class="dl">"</span><span class="p">;</span>
  <span class="nx">c</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="nx">k</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="nx">k</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">rgba(0,0,0,.1)</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">k</span><span class="o">*</span><span class="nx">h</span><span class="o">/</span><span class="mi">5</span><span class="o">+</span><span class="nx">h</span><span class="o">/</span><span class="mi">10</span><span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">f</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span><span class="o">*</span><span class="mi">20</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">15</span><span class="p">;</span><span class="nx">i</span><span class="o">--</span><span class="p">;)</span><span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">w</span><span class="o">/</span><span class="mi">15</span><span class="o">*</span><span class="nx">i</span><span class="o">+</span><span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="o">*</span><span class="nx">r</span><span class="p">());</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="o">-</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">for</span><span class="p">(</span><span class="nx">K</span><span class="o">=</span><span class="mi">199</span><span class="p">;</span><span class="nx">K</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
    <span class="nx">k</span><span class="o">=</span><span class="p">(</span><span class="nx">K</span><span class="o">+</span><span class="p">(</span><span class="nx">f</span><span class="o">%</span><span class="mi">200</span><span class="p">))</span><span class="o">%</span><span class="mi">200</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="nx">p</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">/</span> <span class="p">(</span><span class="mi">30</span> <span class="o">+</span> <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">--</span><span class="p">),</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
    <span class="nx">Z</span><span class="o">=</span><span class="p">(</span><span class="nx">h</span><span class="o">/</span><span class="mi">2</span><span class="o">&gt;</span><span class="mi">230</span><span class="p">)?</span><span class="mi">230</span><span class="p">:</span><span class="nx">h</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">w</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">500</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="nx">f</span><span class="p">)</span><span class="o">*-</span><span class="nx">p</span><span class="p">,</span><span class="nx">h</span><span class="o">-</span><span class="nx">Z</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">f</span><span class="o">/</span><span class="mi">30</span><span class="p">));</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span><span class="nx">p</span><span class="p">);</span>
    <span class="nx">r</span><span class="p">();</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">hsl(</span><span class="dl">"</span><span class="o">+</span><span class="p">[</span><span class="nx">e</span><span class="p">,</span><span class="dl">"</span><span class="s2">90%</span><span class="dl">"</span><span class="p">,</span><span class="nx">g</span><span class="o">-</span><span class="mi">30</span><span class="o">+</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">13</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">%)</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="o">-</span><span class="nx">h</span><span class="o">*</span><span class="mi">15</span><span class="p">,</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nx">h</span><span class="o">*</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">hsl(</span><span class="dl">"</span><span class="o">+</span><span class="p">[</span><span class="nx">e</span><span class="p">,</span><span class="dl">"</span><span class="s2">90%</span><span class="dl">"</span><span class="p">,</span><span class="nx">g</span><span class="o">-</span><span class="mi">25</span><span class="o">+</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">13</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">%)</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="nx">r</span><span class="p">(),</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mi">500</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">hsla(</span><span class="dl">"</span><span class="o">+</span><span class="p">[</span><span class="nx">e</span><span class="p">,</span><span class="dl">"</span><span class="s2">90%</span><span class="dl">"</span><span class="p">,</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">8</span><span class="o">+</span><span class="mi">15</span><span class="o">+</span><span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="dl">"</span><span class="s2">%</span><span class="dl">"</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">150</span><span class="p">)</span><span class="o">/</span><span class="mi">30</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">)</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="p">()</span><span class="o">&lt;</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="nx">T</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">150</span><span class="o">-</span><span class="mi">2500</span><span class="o">*</span><span class="nx">r</span><span class="p">(),</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">4</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="p">()</span><span class="o">&lt;</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="nx">T</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2500</span><span class="o">*</span><span class="nx">r</span><span class="p">()</span><span class="o">+</span><span class="mi">650</span><span class="p">,</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="mi">4</span><span class="p">]);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="o">%</span><span class="mi">200</span><span class="o">==</span><span class="nx">k</span><span class="p">)</span><span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">((</span><span class="nx">f</span><span class="o">+</span><span class="mi">181</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span><span class="o">*</span><span class="mi">500</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span><span class="mi">150</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">k</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span><span class="mi">200</span><span class="o">+</span><span class="nx">f</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="nx">f</span><span class="o">++</span><span class="p">;</span>

  <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">R</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">T</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">z</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">z</span><span class="o">%</span><span class="mi">1</span><span class="nx">e3</span><span class="o">&lt;</span><span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="mi">28</span><span class="p">;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
    <span class="nx">X</span> <span class="o">=</span> <span class="nx">x</span><span class="o">-</span><span class="mi">20</span> <span class="o">+</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">40</span><span class="p">;</span>
    <span class="nx">Y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">-</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">40</span> <span class="o">-</span> <span class="mi">280</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">X</span><span class="p">,</span><span class="nx">Y</span><span class="p">);</span>
    <span class="nx">X</span> <span class="o">=</span> <span class="nx">x</span><span class="o">-</span><span class="mi">20</span> <span class="o">+</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">40</span><span class="p">;</span>
    <span class="nx">Y</span> <span class="o">=</span> <span class="nx">Y</span> <span class="o">-</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">40</span> <span class="o">-</span> <span class="mi">280</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">X</span><span class="p">,</span><span class="nx">Y</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">360</span><span class="p">;</span><span class="nx">i</span><span class="o">+=</span><span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">15</span><span class="o">+</span><span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="nx">c</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">X</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">70</span><span class="p">),</span> <span class="nx">Y</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">40</span><span class="p">));</span>
      <span class="k">else</span> <span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">X</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">70</span><span class="p">),</span> <span class="nx">Y</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">40</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">600</span><span class="p">);</span>
    <span class="nx">X</span> <span class="o">=</span> <span class="mi">99</span> <span class="o">+</span> <span class="nx">r</span><span class="p">()</span><span class="o">*</span><span class="mi">50</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="o">-</span><span class="nx">X</span><span class="o">+</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">X</span><span class="o">+</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
  <span class="p">}</span>

<span class="p">}</span></code></pre></figure> <p>The code was then passed through <a href="https://closure-compiler.appspot.com/" target="_blank" rel="noopener noreferrer">Closure Compiler</a> and <a href="http://siorki.github.io/regPack.html" target="_blank" rel="noopener noreferrer">RegPack</a>, which is a little improvement from the past years because I haven’t discovered RegPack yet and used <a href="http://www.iteral.com/jscrush/" target="_blank" rel="noopener noreferrer">JS Crush</a> instead which is pretty good already. Also, if you’re wondering, the original original source was 1688 bytes long and then crushed into 1004 bytes (-684B, -40.52%). Yes, I copied that data and that’s how I knew that I didn’t recover the whole original source successfully.</p> <h2 id="the-trees"> <a href="#the-trees" aria-hidden="true">#</a> The Trees </h2> <p>I decided to talk about these first and in a separate section because let’s face it, most of the things you see in the demo are just trees. If you watched the demo long enough, you will discover that there are two types of trees, the ‘normal trees’, and the ‘triangle trees’. I will only cover the normal ones because the triangle trees literally are just triangles.</p> <p>The function that draws trees is named <code class="highlighter-rouge">T()</code> and could be found on lines 91-122 of the gist. The parameters <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> contain the x and y positions of the tree, and the parameter <code class="highlighter-rouge">z</code> is used only to determine whether to show the normal or triangle trees.</p> <p>The trunk of the normal trees are made of two lines with the line width of <code class="highlighter-rouge">r()*12+28</code> (<code class="highlighter-rouge">r()</code> is a seeded random number generator function). The leaves are a little bit more complex, and I recommend you to watch the <a href="https://www.youtube.com/watch?v=SoYnZHBP-6M" target="_blank" rel="noopener noreferrer">4th episode</a> of Coding Math first. In the end of the video you could see circles that are drawn in a circle shape using simple trigonometry, and that’s almost exactly how the leaves are drawn. But instead of drawing circles, the position is used for the <code class="highlighter-rouge">lineTo</code> (or <code class="highlighter-rouge">moveTo</code>) function and then <code class="highlighter-rouge">fill</code> will be called. To make the trees look a little bit different for each of them, the radius of the ‘big circle’ and the angle between each points are a little bit randomized.</p> <p>In the <a href="/post/js1k-2016-elemental-forest-part-2/">next part</a> I will cover about the rest of the stuff in the code, thank you for reading!</p> <script src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> <script> let scriptUrl = "https://platform.twitter.com/widgets.js"; if(!loadedScripts.includes(scriptUrl)) loadedScripts.push(scriptUrl); </script> </article> <section class="container mt-24"> <div class="clearfix max-w-3xl"> <a href="/post/js1k-2016-elemental-forest-part-2/" class="float-right max-w-sm py-6 ml-12 text-right group"> <div class="max-w-sm mb-2 text-xl font-medium text-purple-800 dark:text-teal-300 enter-anim">next post</div> <div class="flex flex-row-reverse font-medium leading-normal enter-anim"> <span class="ml-4 -mt-px transform lg:absolute lg:ml-0 lg:translate-x-9">→</span> <span class="group-hover:underline">JS1k 2016: Elemental Forest — Part 2</span> </div> </a> <a href="/post/the-gold-factory-cipher-answers/" class="float-left max-w-sm py-6 mr-12 group"> <div class="mb-2 text-xl font-medium text-purple-800 dark:text-teal-300 enter-anim">prev post</div> <div class="flex font-medium leading-normal enter-anim"> <span class="mr-4 -mt-px transform lg:absolute lg:mr-0 lg:-translate-x-9">←</span> <span class="group-hover:underline">The Gold Factory Cipher Answers</span> </div> </a> </div> </section> <section class="container mt-12"> <div class="max-w-3xl enter-anim"> <div id="disqus_thread"></div> </div> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by Disqus.</a>
</noscript> </section> </main> <footer class="container mt-16 mb-8 text-base text-gray-700 footer dark:text-gray-500 enter-anim"> This site is designed and built by me using <a href="https://jekyllrb.com/" class="fancy-link" target="_blank" rel="noopener noreferrer">Jekyll</a>, <a href="https://tailwindcss.com/" class="fancy-link" target="_blank" rel="noopener noreferrer">Tailwind CSS</a>, and <a href="https://barba.js.org/" class="fancy-link" target="_blank" rel="noopener noreferrer">barba.js</a>. </footer> </div> <script src="/assets/js/fadeAnimation.js"></script> <script src="https://unpkg.com/@barba/core"></script> <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script> <script> var disqus_config = function () { this.page.identifier = "/post/js1k-2016-elemental-forest-part-1/"; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://gamehelp16.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <script src="/assets/js/barbaTransition.js"></script> </body> </html>
